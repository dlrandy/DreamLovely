# 设计模式之访问者模式

**访问者模式属于行为设计模式**

结构化设计模式是使用新对象(包装对象)来创建新功能

![markdown](https://images.unsplash.com/photo-1576208260328-cc47418da608?ixlib=rb-1.2.1&auto=format&fit=crop&w=668&q=80"
Nathan Dumlao")

### 什么是访问者？
将算法和算法运行所在的对象进行分离。

## 如何实现访问者模式？
把一个新的行为放到一个新的class (visitor),而不是将新的行为整合到已经存在的类里。执行行为的最初的对象作为访问者某个方法的一个参数，并提供方法能够访问到对象所包含的必要数据。

##具体思路
访问者使用了double dispatch 的方法，在没有过多的条件下帮助执行对象上的正确方法。就是不让用户选择适当的方法，而是将这个选择代理到作为参数传给访问者的对象。


##思考方式
访问者其实是一个保险销售人员：
1. 当他出现在居民区的时候，卖医疗保险
2. 出现在银行的时候，卖防盗保险
3. 在咖啡店，卖水火保险


##实现方式
1. Visitor接口声明一组visiting方法，接收实体对象结构作为参数，这些方法名字可以相同，但是参数的类型必须不同；或者名字就不同
2. 每个实体Visitor实现不同版本的行为，适配不同的实体元素类
3. 元素接口声明一个接收visitor的方法，这个方法至少接收一个visitor接口的类型
4. 每一个实体元素必须实现accept方法，这个方法的目的在于将正确的visitor方法重定向到当前的元素类
5. Client代表复杂对象，将访问者和实体元素进行关联

##什么时候使用Visitor模式？
1. 当需要在一个复杂对象的所有元素上执行一个操作的时候
	通过visitor对象实现同一操作的不同变种，将一个操作(变种)运行在不同的类的对象上
2. 使用visitor取清理业务逻辑的附加/辅助行为
	该模式让App的主要类更加的关注于主要的业务，通过提取所有其他的行为到访问者class。
3. 当一个行为只在一个类层级的某些类里有意义的时候
	可以将这个行为抽取到一个独立的visitor类里，只实现相关类的的visiting方法，其他的置空

##如何实现访问者模式？
1. 声明访问者接口的一系列visiting方法，一个实体元素类一个
2. 声明元素接口。如果元素类是有层级的，那么添加一个抽象的acceptance方法给基类，这个方法应该接收visitor作为参数
3. 在所有的实体元素类中实现acceptance方法。这些方法必须调用visitor对象的visiting方法
4. 元素类应该只通过visitor的接口使用visitor。但是visitor要意识到所有的实体元素类，这些元素类作为visiting方法的参数类型。
5. 对于在元素层级内不能实现的行为，创建一个实体的visitor类，并实现所有的visiting方法
>  如果visitor需要访问element类的私有成员，要么使得这些成员公有，要么在元素类里内置visitor类
6. client必须创建visitor对象通过acceptance方法将visitor传递给元素

##优点
1.  单一职责，同一个次能给的多个版本可以放在同一个类里
2.  开闭原则，引入用于多个类的行为，而不会破坏这些类
3. visitor可以采集不同对象的有用信息。在遍历复杂对象结构的时候，将访问者应用到结构里的每一个对象

##缺点
1. 每次有class加入或者移除的时候，需要更新所有的visitors
2. visitor 可能缺失对元素的私有属性的访问

![eberhard grossgasteiger](https://images.unsplash.com/photo-1574270981993-f1df213562b3?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80 "eberhard grossgasteiger")End
